<!DOCTYPE html>

<head>
  <title>whatever</title>
</head>

<body>

  <p id="story"></p>

  <h3>words</h3>
  <div id="words"></div>

  <p id="turn"></p>

  <script type="text/javascript">

    let id;

    let ws = new WebSocket('ws://localhost:8080/status');
    ws.onerror = e => console.log(e);
    ws.onopen = () => console.log('open');
    ws.onclose = () => console.log('close');
    ws.onmessage = e => {

      const msg = JSON.parse(e.data);
      console.log(msg);

      if (msg.id !== undefined) {
        id = msg.id;
      }

      if (msg.words !== undefined) {
        let wordsDiv = document.getElementById('words');
        // Wipe its children.
        while (wordsDiv.firstChild) wordsDiv.removeChild(wordsDiv.firstChild);
        // Append each of the words.
        msg.words.forEach(word => {
          let node = document.createElement('P');
          let text = document.createTextNode(word.word);
          node.appendChild(text);
          node.onclick = () => ws.send(JSON.stringify({ id: word.id }));
          wordsDiv.appendChild(node);
        });
      }

      if (msg.story !== undefined) {
        document.getElementById('story').innerHTML = msg.story;
      }

      if (msg.turn !== undefined) {
        document.getElementById('turn').innerHTML = msg.turn == id ? 'Your Turn!' : 'Not Your Turn';
      }

    }

  </script>

</body>